#!/bin/sh

list_all_ports() {
	find ports -type d ! -path ports -exec basename {} \;
}

ports_has() {
	[ ! -f "ports/$1/APKBUILD" ] && return 1 || true
}

get_variable_value() {
	if ! ports_has "$1" || [ -z "$2" ]; then
		return 1
	fi

	variable_line=$(grep -s '^'"$2"'=.*' ports/"$1"/APKBUILD)

	if [ -n "$variable_line" ]; then
		echo ${variable_line#*=} | sed -e 's/^"\(.*\)"$/\1/g'
	else
		echo "$3"
	fi
}

get_apkbuild_description() {
	get_variable_value "$1" 'pkgdesc'
}

get_apkbuild_url() {
	get_variable_value "$1" 'url'
}

get_apkbuild_version() {
	get_variable_value "$1" 'pkgver'
}

opt=${1:-'-a'}
shift 

case $opt in
	'-a') list_all_ports ;;
	'-d') get_apkbuild_description "$1" ;;
	'-e') ports_has "$1" ;;
	'-u') get_apkbuild_url "$1" ;;
	'-v') get_apkbuild_version "$1" ;;
esac

